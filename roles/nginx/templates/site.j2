# {{ ansible_managed }}

server {
  listen [::]:443 ssl http2;
  listen 443 ssl http2;

  server_name www.{{ server_name }};

  ssl_certificate /etc/letsencrypt/live/{{ server_name }}/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/{{ server_name }}/privkey.pem;
  ssl_trusted_certificate /etc/letsencrypt/live/{{ server_name }}/chain.pem;

  add_header Strict-Transport-Security "max-age=63072000" always;

  return 301 https://{{ server_name }}$request_uri;
}


server {
  listen [::]:443 ssl http2;
  listen 443 ssl http2;

  server_name {{ server_name }};
  root /srv/www/{{ server_name }}/public;

  {# error_page 404 /404.html; #}

  ssl_certificate /etc/letsencrypt/live/{{ server_name }}/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/{{ server_name }}/privkey.pem;
  ssl_trusted_certificate /etc/letsencrypt/live/{{ server_name }}/chain.pem;

  add_header Strict-Transport-Security "max-age=63072000" always;
  add_header X-Content-Type-Options "nosniff" always;
  add_header Content-Security-Policy "default-src 'self'; base-uri 'none'; form-action 'self'; frame-ancestors 'none'; object-src 'none'; upgrade-insecure-requests" always;
  add_header Referrer-Policy "no-referrer, strict-origin-when-cross-origin" always;
  add_header Cross-Origin-Embedder-Policy	"require-corp" always;
  add_header Cross-Origin-Opener-Policy	"same-origin" always;
  add_header Cross-Origin-Resource-Policy	"same-origin" always;
}

